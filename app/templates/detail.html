{% extends "base.html" %}

{% block app_content %}
    {% with messages = get_flashed_messages() %}
        {% if messages %}
        <ul>
            {% for message in messages %}
            <li>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endwith %}
    <h1>GODOT Detail View</h1>
    <h3 style="margin-bottom: 2em;"><div id="godot_uri">https://godot.date/id/{{ id }}</div></h3>
        <div class="g_tooltip">
            <button class="btn btn-godot-reset btn-xs" style="margin-left:0; width:200px; margin-top:-3em;" onclick="copy2clipboard()" id="copy_button">
                Copy URI to clipboard
            </button>
        </div>
    <h3>Calendar Date Information</h3>
    <ul>
    {%- for path in paths %}
        {%- if path.label == 'YearReferenceSystem' %}
            {%- for key, value in path.items() %}
                {%- if key == 'type' %}
                    <li>{{ value }}</li>
                {%- endif %}
            {%- endfor %}
        {%- elif path.label == 'CalendarType' %}
            {%- for key, value in path.items() %}
                {%- if key != 'label' %}
                    <li>{{ key }}: {{ value }}</li>
                {%- endif %}
            {%- endfor %}
        {%- elif path.label == 'CalendarPartial' %}
            {%- for key, value in path.items() %}
                {%- if key != 'label' %}
                    {%- if key == 'type' %}
                        {{ value }}:
                    {%- elif key == 'uri' %}
                        <a href="{{ value }}">{{ value }}</a><br />
                    {%- else %}
                        {{ value }}<br/>
                    {%- endif %}
                {%- endif %}
            {%- endfor %}
        {%- elif path.label == 'GODOT' %}
            GODOT Information:
            <ul>
            {%- for key, value in path.items() %}
                {%- if key != 'type' and key != 'label' and value != '' %}
                    {%- if key == 'uri' %}
                        <li>GODOT {{ key.upper() }}: <a href="{{ value }}">{{ value }}</a></li>
                    {%- elif key == 'not_before' or key == 'not_after' %}
                        <li>{{ key }}: {{ value }}</li>
                    {% else %}
                        <li>{{ key }}: {{ value }}</li>
                    {%- endif %}
                {%- endif %}
            {%- endfor %}
            </ul>
        {%- endif %}
    {%- endfor %}
    </ul>
    <h3>Attestations</h3>
    {%- for att in attestations %}
        {%- if get_username() == "roueche" or get_username() == "grieshaber" %}
            <p style="margin-bottom:2em"><a href="{{ att.uri }}">{{ att.title }}</a>
                {%- if att.date_category and att.date_category[0] != "<" and att.date_category != "" %}
                    ({{ att.date_category }})
                {%- endif %}
                <a href="/id/{{ id }}/{{ att.node_id }}/edit" class="btn btn-godot-reset btn-xs">edit</a> &nbsp; <a href="/id/{{ id }}/{{ att.node_id }}/delete" class="btn btn-godot-reset btn-xs">delete</a><br />{{ att.date_string }} <br />
                {%- if att.username %}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contributor: {{ att.username }} {%- endif %}
                {%- if att.last_update %} (last update: {{ att.last_update }}){%- endif %}
            </p>
        {%- else %}
            <p><a href="{{ att.uri }}">{{ att.title }}</a> {%- if att.date_category and att.date_category[0] != "<" and att.date_category != "" %}
                    ({{ att.date_category }})
                {%- endif %}:<br />{{ att.date_string }}<br />
                {%- if att.username %}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contributor: {{ att.username }} {%- endif %}
                {%- if att.last_update %} (last update: {{ att.last_update }}){%- endif %}
            </p>
        {%- endif %}
    {%- endfor%}
    <p>&nbsp;</p>
    <script>
        function copy2clipboard() {
            let textarea = document.createElement('textarea')
            textarea.id = 't'
            textarea.style.height = 0
            document.body.appendChild(textarea)
            textarea.value = document.getElementById("godot_uri").innerText
            let selector = document.querySelector('#t')
            selector.select()
            document.execCommand('copy')
            document.body.removeChild(textarea)
            document.getElementById("copy_button").innerText = "Copied!"
            setTimeout(function() {
                document.getElementById("copy_button").innerText = "Copy URI to clipboard"
            }, 1000);
        }
    </script>
{% endblock %}
